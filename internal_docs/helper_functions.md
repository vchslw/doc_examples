---
description: >-
  Документация к модулю helper.py моего проекта с автотестами:
  https://gitlab.com/vches/aqa_demo. Целевая аудитория — разработчики и инженеры
  по автоматизации тестирования.
hidden: true
layout:
  title:
    visible: true
  description:
    visible: true
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
---

# Функции модуля helper

## Основное

Модуль `helper` находится в репозитории `aqa_demo`, в директории `/libs`.

Модуль содержит функции, которые используются в других модулях и функциях проекта, для соответствия принципу DRY и упрощения кода.

## find\_element()

### Описание

Функция предназначена для нахождения элемента интерфейса на странице:

* В аргументе `data` она принимает ID или класс элемента.
* С помощью функции Playwright `locator()` находит элемент с указанным ID или классом.
* Сохраняет элемент в локальную переменную `element`.
* Возвращает переменную `element`.

`find_element()` используется внутри функций [`check_sort_option_swithcing()`](helper_functions.md#check_sort_option_swithcing) и [`check_items_sorting()`](helper_functions.md#check_items_sorting).

### Аргументы

| Название аргумента | Тип данных                                                | Пример значения            | Комментарий                                                                                                          |
| ------------------ | --------------------------------------------------------- | -------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| `page`             | [Page](https://playwright.dev/python/docs/api/class-page) | `chrome_page_with_cookies` | Фикстура, которая предоставляет отдельную страницу браузера. Хранится в `conftest.py` в корне проекта.               |
| `data`             | string                                                    | `".main_block"`            | ID или класс элемента страницы, который необходимо найти. **Нужно указывать # перед ID и . перед названием класса.** |

### Возврат

Функция возвращает элемент страницы в виде [локатора Playwright](https://playwright.dev/docs/locators#locate-by-css-or-xpath).

## make\_items\_lower()

{% hint style="info" %}
Легаси функция, на данный момент нигде не используется.
{% endhint %}

## delete\_symbols\_from\_items()

### Описание

Функция удаляет символы из элементов списка или кортежа:

* В аргументе `list_to_edit` передается список или кортеж, в элементах которого нужно удалить определенные символы.
* В аргументе `symbols_to_delete` — список или кортеж символов, которые нужно удалить.
* Функция итерирует все элементы списка или кортежа `symbols_to_delete`.
* Внутри цикла с итерацией `symbols_to_delete` запускается другой цикл — функция проходит по символам каждого элемента `list_to_edit` и удаляет из них символы, указанные в `symbols_to_delete`.
* Функция возвращает `list_to_edit` с удаленными символами из его элементов.

`delete_symbols_from_items()` используется в [`check_items_sorting()`](helper_functions.md#check_items_sorting).

### Аргументы

| Название аргумента  | Тип данных     | Пример значения    |
| ------------------- | -------------- | ------------------ |
| `list_to_edit`      | list или tuple | `["100$", "200€"]` |
| `symbols_to_delete` | list или tuple | `("$", "€")`       |

### Возврат

Функция возвращает измененный список или кортеж `list_to_edit`, не изменяя его тип данных и не записывая его значение в другую переменную.

## check\_sort\_option\_swithcing()

### Описание

Функция используется в модулях с тестами для проверки переключения вариантов сортировки:

* В аргумента `selector_data` функция принимает ID или класс селектора.
* В аргументе `option` — значение атрибута `value` тега `<option>`.
* В аргументе `active_option_data` — ID или класс установленного варианта сортировки.
* Функция находит селектор с помощью [`find_element()`](helper_functions.md#find_element) и записывает его в локальную переменную `selector`.
* Затем функция переключает сортировку на веб-странице с помощью функции Playwright [`select_option()`](https://playwright.dev/python/docs/input#select-options) на вариант, переданный в аргументе `option`.
* После этого функция находит активный вариант сортировки и сохраняет его в локальную переменную `active_option`.
* Затем берет текст активной опции, который отображается на странице, и записывает его в переменную `active_option_text`.
* Функция возвращает переменную `active_option_text`.

### Аргументы

| Название аргумента   | Тип данных                                                | Пример значения            | Комментарий                                                                                            |
| -------------------- | --------------------------------------------------------- | -------------------------- | ------------------------------------------------------------------------------------------------------ |
| `page`               | [Page](https://playwright.dev/python/docs/api/class-page) | `chrome_page_with_cookies` | Фикстура, которая предоставляет отдельную страницу браузера. Хранится в `conftest.py` в корне проекта. |
| `selector_data`      | string                                                    | `".sort_container_class"`  | ID или класс селектора на странице. **Нужно указывать # перед ID и . перед названием класса.**         |
| `option`             | string                                                    | `"az"`                     | Значение атрибута `value` тега `<option>` у варианта сортировки.                                       |
| `active_option_data` | string                                                    | `"#active_option_id"`      | ID или класс активного варианта сортировки. **Нужно указывать # перед ID и . перед названием класса.** |

### Возврат

Функция возвращает переменную `active_option_text`, которая содержит строку с текстом активной опции сортировки. Значение переменной можно использовать в тестах для сравнения с ожидаемым значением.

## check\_items\_sorting()

### Описание

Переключает сортировку на странице, собирает нужные значения из элементов в список, создает новый список с теми же значениями, сортирует его, а затем сравнивает полученные списки:

* Используя ID или класс селектора сортировки, переданный в аргументе `selector_data`, и функцию [`find_element()`](helper_functions.md#find_element), функция находит на странице селектор.
* Затем выбирает вариант сортировки, переданный в аргументе `sort_option`.
* После этого функция собирает отсортированные элементы на странице в список `elements_list`, используя класс этих элементов (`items_class`) и функцию Playwright [`query_selector_all()`](https://playwright.dev/python/docs/api/class-page#page-query-selector-all).
* Тексты элементов с классом `items_class` приводятся к нижнему регистру собираются в список `items_list`.

{% hint style="info" %}
Приведение строк к нижнему регистру необходимо для корректной сортировки, т. к. функция стандартной библиотеки [`sorted()`](https://docs.python.org/3/library/functions.html#sorted) учитывает регистр символов.
{% endhint %}

* Затем из полученного списка удаляются ненужные символы с помощью функции [`delete_symbols_from_items()`](helper_functions.md#delete_symbols_from_items).
* Полученный список сохраняется в переменную `new_list`.
* Затем функция сортирует `new_list` по возрастанию или по убыванию — в зависимости от значения аргумента `direction`.
* Если `new_list` содержит числа и/или числа с плавающей точкой, в `sorted()` используется анонимная функция `lambda x: (float(x), abs(float(x)))` . С ее помощью элементы списка сортируются сначала по числовым значениям, а затем — по абсолютным, если числовые значения равны. Отсортированный список в этом случае сохраняется в локальную переменную `valid_list_floats`.
* &#x20;Затем функция сравнивает, равны ли `items_list` и `valid_list`/`valid_list_floats`.

### Аргументы

| Название аргумента | Тип данных                                                | Пример значения                                                | Комментарий                                                                                                                                          |
| ------------------ | --------------------------------------------------------- | -------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| `page`             | [Page](https://playwright.dev/python/docs/api/class-page) | `chrome_page_with_cookies`                                     | Фикстура, которая предоставляет отдельную страницу браузера. Хранится в `conftest.py` в корне проекта.                                               |
| `selector_data`    | string                                                    | `".sort_container_class"`                                      | ID или класс селектора на странице. **Нужно указывать # перед ID и . перед названием класса.**                                                       |
| `sort_option`      | string                                                    | `"az"`                                                         | Значение атрибута `value` тега `<option>` у варианта сортировки.                                                                                     |
| `items_class`      | string                                                    | `"#active_option_id"`                                          | ID или класс активного варианта сортировки. **Нужно указывать # перед ID и . перед названием класса.**                                               |
| `direction`        | string                                                    | `"asc"`                                                        | **Допустимые значения только `"asc"` и `"desc"`.**                                                                                                   |
| `**kwargs`         |                                                           | `symbols_to_delete=("Sauce Labs", "Test.allTheThings()", "$")` | Используются для случаев, когда нужно удалить символы из текстов элементов. Символы нужно передавать в виде кортежа в аргументе `symbols_to_delete`. |

### Возврат

Функция возвращает булев, полученный при сравнении двух списков:

* `items_list` — список текстов внутри элементов с классом `items_class`, который был получен в результате сортировки элементов на странице.
* `valid_list` или `valid_list_floats` — это `items_list`, отсортированный внутри этой функции.
  * `valid_list` используется, когда список содержит строковые значения.
  * `valid_list_floats` — когда список содержит числа и/или числа с плавающей точкой.
